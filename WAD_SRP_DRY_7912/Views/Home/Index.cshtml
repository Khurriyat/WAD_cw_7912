
@{
    ViewData["Title"] = "API Client Angular Professionals";
}

<h1>Professionals</h1>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>

<div id="professionalsContainer" ng-app="professionalsApp">
    <div ng-controller="professionalsController">

        <div class="alert alert-info" ng-if="message">
            <a href="#" class="close" ng-click="clearMessage()">&times;</a>
            {{message}}
        </div>

        <table class="table table-bordered">
            <tbody>

                <tr>
                    <td>
                        <strong>Id</strong>
                    </td>
                    <td>
                        <strong>First Name</strong>
                    </td>
                    <td>
                        <strong>Last Name</strong>
                    </td>
                    <td>
                        <strong>Date of Birth</strong>
                    </td>
                    <td>
                        <strong>Education</strong>
                    </td>
                    <td>
                        <strong>Work Experience</strong>
                    </td>
                    <td>
                        <strong>Speciality</strong>
                    </td>
                    <td>
                        <strong>Phone Number</strong>
                    </td>
                    <td>
                        <strong>Email</strong>
                    </td>
                    <td>
                        <strong>Address</strong>
                    </td>
                    <td>
                        <strong>Delete</strong>
                    </td>
                    <td>
                        <strong>Edit</strong>
                    </td>
                </tr>

                <tr ng-repeat="professional in professionals">
                    <td>
                        {{professional.id}}
                    </td>
                    <td>
                        {{professional.firstName}}
                    </td>
                    <td>
                        {{professional.lastName}}
                    </td>
                    <td>
                        <label ng-bind="formatDate(professional.doB) | date:'dd/MM/yyyy'"></label>
                    </td>
                    <td>
                        {{professional.education}}
                    </td>
                    <td>
                        {{professional.workExperience}}
                    </td>
                    <td>
                        {{professional.speciality}}
                    </td>
                    <td>
                        {{professional.phoneNo}}
                    </td>
                    <td>
                        {{professional.email}}
                    </td>
                    <td>
                        {{professional.address}}
                    </td>
                    <td>
                        <input type="button" class="btn btn-danger" value="x" ng-click="delete(professional)" />
                    </td>
                    <td>
                        <button type="button" class="btn btn-info" data-toggle="modal" data-target="#myModal" ng-click="selectProfessional(professional)">Edit</button>
                    </td>
                </tr>
            </tbody>

            <tfoot>
                <tr>
                    <td></td>
                    <td>
                        <input ng-model="firstName" placeholder="First name" type="text" />
                    </td>
                    <td>
                        <input ng-model="lastName" placeholder="Last name" type="text" />
                    </td>
                    <td>
                        <input ng-model="doB" placeholder="Date of Birth" type="date" />
                    </td>
                    <td>
                        <input ng-model="education" placeholder="Education" type="text" />
                    </td>
                    <td>
                        <input ng-model="workExperience" placeholder="Work experience" type="text" />
                    </td>
                    <td>
                        <input ng-model="speciality" placeholder="Speciality" type="text" />
                    </td>
                    <td>
                        <input ng-model="phoneNo" placeholder="Phone number" type="text" />
                    </td>
                    <td>
                        <input ng-model="email" placeholder="Email" type="email" />
                    </td>
                    <td>
                        <input ng-model="address" placeholder="Address" type="text" />
                    </td>
                    <td>
                        <input class="btn btn-primary" ng-click="add()" type="button" value="+" />
                    </td>
                    <td></td>
                </tr>
            </tfoot>
        </table>

        <div class="modal fade" id="myModal" role="dialog">
            <div class="modal-dialog">

                <div class="modal-content">
                    <div class="modal-header">
                        <h4 class="modal-title">Edit Professional</h4>
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                    </div>

                    <div class="modal-body">
                        <form class="form-horizontal" action="/action_page.php">

                            <div class="form-group">
                                <label class="control-label col-sm-10">First Name</label>
                                <div class="col-sm-10">
                                    <input type="text" class="form-control" ng-model="clickedProfessional.firstName">
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="control-label col-sm-10">Last Name</label>
                                <div class="col-sm-10">
                                    <input type="text" class="form-control" ng-model="clickedProfessional.lastName">
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="control-label col-sm-10">Date of Birth</label>
                                <div class="col-sm-10">
                                    <input type="date" class="form-control" ng-model="clickedProfessional.doB">
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="control-label col-sm-2">Education</label>
                                <div class="col-sm-10">
                                    <input type="text" class="form-control" ng-model="clickedProfessional.education">
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="control-label col-sm-10">Work Experience</label>
                                <div class="col-sm-10">
                                    <input type="text" class="form-control" ng-model="clickedProfessional.workExperience">
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="control-label col-sm-2">Speciality</label>
                                <div class="col-sm-10">
                                    <input type="text" class="form-control" ng-model="clickedProfessional.speciality">
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="control-label col-sm-10">Phone Number</label>
                                <div class="col-sm-10">
                                    <input type="text" class="form-control" ng-model="clickedProfessional.phoneNo">
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="control-label col-sm-2">Email</label>
                                <div class="col-sm-10">
                                    <input type="email" class="form-control" ng-model="clickedProfessional.email">
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="control-label col-sm-2">Address</label>
                                <div class="col-sm-10">
                                    <input type="text" class="form-control" ng-model="clickedProfessional.address">
                                </div>
                            </div>

                            <div class="form-group">
                                <div class="col-sm-offset-2 col-sm-10">
                                    <button type="submit" class="btn btn-info" data-dismiss="modal" ng-click="update()">Save</button>
                                </div>
                            </div>
                        </form>
                    </div>

                    <div class="modal-footer">
                        <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>

    </div>
</div>



@section Scripts {

    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.8.2/angular.min.js" type="text/javascript"></script>
    <script>
        angular.module('professionalsApp', [])
            .controller('professionalsController', function ($scope, $http) {
                $http.get("@Url.Action("GetProfessionals", "Professionals")").then(function (response) {
                    $scope.professionals = response.data;
                });

                $scope.formatDate = function (date) {
                    return new Date(date);
                }

                $scope.clickedProfessional = {};
                $scope.selectProfessional = function (professional) {
                    $scope.clickedProfessional = professional;
                };
                $scope.message = "";


                $scope.update = function () {
                    $scope.message = "Professional is updated successfully!";
                };


                $scope.add = function () {
                    var professional = {
                        firstName: $scope.firstName,
                        lastName: $scope.lastName,
                        doB: $scope.doB,
                        education: $scope.education,
                        workExperience: $scope.workExperience,
                        speciality: $scope.speciality,
                        phoneNo: $scope.phoneNo,
                        email: $scope.email,
                        address: $scope.address
                    };

                    $http.post("@Url.Action("PostProfessional", "Professionals")", professional).then(function (response) {
                        $scope.professionals.push(response.data);
                    });

                    $scope.firstName = '';
                    $scope.lastName = '';
                    $scope.doB = '';
                    $scope.education = '';
                    $scope.workExperience = '';
                    $scope.speciality = '';
                    $scope.phoneNo = '';
                    $scope.email = '';
                    $scope.address = '';

                    $scope.message = "New professional is added successfully!";
                }
                $scope.delete = function (professional) {
                    var result = confirm("Do you want to delete the professional?")
                    if (result == true) {
                        $http.delete("@Url.Action("PostProfessional", "Professionals")/" + professional.id).then(function (response) {
                            var index = $scope.professionals.indexOf(professional);
                            $scope.professionals.splice(index, 1);
                            $scope.message = "Professional is deleted successfully!";
                        });
                    }
                }

                $scope.clearMessage = function () {
                    $scope.message = "";
                };
            });
    </script>
}
