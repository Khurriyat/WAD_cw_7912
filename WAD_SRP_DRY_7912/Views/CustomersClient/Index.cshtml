
@{
    ViewData["Title"] = "API Client Angular Customers";
}

<h1>Customers</h1>

<div id="customersContainer" ng-app="customersApp">
    <div ng-controller="customersController">
        <table class="table">
            <tbody>

                <tr>
                    <td>
                        <strong>Id</strong>
                    </td>
                    <td>
                        <strong>First Name</strong>
                    </td>
                    <td>
                        <strong>Last Name</strong>
                    </td>
                    <td>
                        <strong>Phone Number</strong>
                    </td>
                    <td>
                        <strong>Email</strong>
                    </td>
                    <td>
                        <strong>Address</strong>
                    </td>
                    <td>
                        <strong>No of Pets</strong>
                    </td>
                    <td>
                        <strong>Professional Id</strong>
                    </td>
                </tr>

                <tr ng-repeat="customer in customers">
                    <td>
                        {{customer.id}}
                    </td>
                    <td>
                        {{customer.firstName}}
                    </td>
                    <td>
                        {{customer.lastName}}
                    </td>
                    <td>
                        {{customer.phoneNo}}
                    </td>
                    <td>
                        {{customer.email}}
                    </td>
                    <td>
                        {{customer.address}}
                    </td>
                    <td>
                        {{customer.noOfPets}}
                    </td>
                    <td>
                        {{customer.professionalId}}
                    </td>
                    <td>
                        <input type="button" class="btn-danger" value="x" ng-click="delete(customer)" />
                    </td>
                </tr>
            </tbody>
            <tfoot>
                <tr>
                    <td>
                    </td>
                    <td>
                        <input ng-model="firstName" placeholder="First name" type="text" />
                    </td>
                    <td>
                        <input ng-model="lastName" placeholder="Last name" type="text" />
                    </td>
                    <td>
                        <input ng-model="phoneNo" placeholder="Phone number" type="text" />
                    </td>
                    <td>
                        <input ng-model="email" placeholder="Email" type="email" />
                    </td>
                    <td>
                        <input ng-model="address" placeholder="Address" type="text" />
                    </td>
                    <td>
                        <input ng-model="noOfPets" placeholder="No of pets" type="number" />
                    </td>
                    <td>
                        <input ng-model="professionalId" placeholder="Professional Id" type="number" />
                    </td>
                    <td>
                        <input class="btn-primary" ng-click="add()" type="button" value="+" />
                    </td>
                </tr>
            </tfoot>
        </table>
    </div>
</div>

@section Scripts {
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.8.2/angular.min.js" type="text/javascript"></script>
    <script>
        angular.module('customersApp', [])
            .controller('customersController', function ($scope, $http) {
                $http.get("@Url.Action("GetCustomers", "Customers")").then(function (response) {
                    $scope.customers = response.data;
                });
                $scope.add = function () {
                    var customer = {
                        firstName: $scope.firstName,
                        lastName: $scope.lastName,
                        phoneNo: $scope.phoneNo,
                        email: $scope.email,
                        address: $scope.address,
                        noOfPets: $scope.noOfPets,
                        professionalId: $scope.professionalId
                    };

                    $http.post("@Url.Action("PostCustomer", "Customers")", customer).then(function (response) {
                        $scope.customers.push(response.data);
                    });

                    $scope.firstName = '';
                    $scope.lastName = '';
                    $scope.phoneNo = '';
                    $scope.email = '';
                    $scope.address = '';
                    $scope.noOfPets = '';
                    $scope.professionalId = '';
                }
                $scope.delete = function (customer) {
                    $http.delete("@Url.Action("PostCustomer", "Customers")/" + customer.id).then(function (response) {
                        var index = $scope.customers.indexOf(customer);
                        $scope.customers.splice(index, 1);
                    });
                }
            });
    </script>
}